<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Gmail Inbox</title>
<style>
body { font-family: Arial; background:#f4f4f9; padding:20px; }
.folder-section { margin-bottom:30px; }
.folder-title { font-size:1.4em; margin-bottom:10px; color:#333; }
.email-card { background:#fff; border-radius:8px; padding:15px; margin-bottom:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.email-header { display:flex; justify-content:space-between; cursor:pointer; }
.email-subject { font-weight:bold; font-size:1.1em; }
.email-body { margin-top:10px; display:none; white-space: pre-wrap; }
button { background:#007bff; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer; }
button:hover { background:#0056b3; }
</style>
</head>
<body>

<h1>Mini Gmail Inbox</h1>
<div id="emails-container"></div>

<script>
async function loadEmails() {
    try {
        const response = await fetch('http://127.0.0.1:8000/api/emails');
        const emails = await response.json();

        // Group emails by folder
        const folders = {};
        emails.forEach(email => {
            const folder = email.folder || "INBOX";
            if (!folders[folder]) folders[folder] = [];
            folders[folder].push(email);
        });

        const container = document.getElementById('emails-container');
        container.innerHTML = '';

        // Display each folder
        for (const folderName of Object.keys(folders)) {
            const section = document.createElement('div');
            section.className = 'folder-section';

            const title = document.createElement('div');
            title.className = 'folder-title';
            title.textContent = folderName;
            section.appendChild(title);

            folders[folderName].forEach(email => {
                const card = document.createElement('div');
                card.className = 'email-card';

                const header = document.createElement('div');
                header.className = 'email-header';

                const subject = document.createElement('div');
                subject.className = 'email-subject';
                subject.textContent = email.subject || "(No Subject)";

                const toggleBtn = document.createElement('button');
                toggleBtn.textContent = 'View';

                header.appendChild(subject);
                header.appendChild(toggleBtn);

                const body = document.createElement('div');
                body.className = 'email-body';
                body.textContent = `From: ${email.from}\nTo: ${email.to}\nDate: ${email.date}\n\n${email.body}`;

                toggleBtn.addEventListener('click', () => {
                    body.style.display = body.style.display === 'none' ? 'block' : 'none';
                });

                card.appendChild(header);
                card.appendChild(body);
                section.appendChild(card);
            });

            container.appendChild(section);
        }

    } catch(err) {
        console.error("‚ùå Failed to fetch emails:", err);
    }
}

// Load initially & refresh every 60s
loadEmails();
setInterval(loadEmails, 60000);
</script>

</body>
</html>
